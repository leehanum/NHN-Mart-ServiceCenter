<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>내 문의 목록 - NHN Mart 고객센터</title>
</head>
<body>

<div>
  <h2 th:if="${session.userId}" th:text="|${session.userId}님 (${user?.name})의 문의 목록|">고객 문의 목록</h2>

  <!-- 로그아웃 버튼 -->
  <form method="post" action="/cs/logout" style="display: inline;">
    <button type="submit">로그아웃</button>
  </form>

  <hr>

  <!-- 문의 분류별 검색 폼 및 문의하기 버튼 -->
  <div>
    <form method="get" action="/cs" style="display: inline;">
      <label for="category-search">문의 분류 검색:</label>
      <select id="category-search" name="category">
        <option value="">전체 보기</option>
        <!-- InquiryCategory Enum 목록을 바인딩 (Controller에서 categories를 Model에 담아야 함) -->
        <option th:each="cat : ${categories}"
                th:value="${cat.name()}"
                th:text="${cat.description}"
                th:selected="${cat.name() == currentCategory}">분류명</option>
      </select>
      <button type="submit">검색</button>
    </form>

    <button type="button" onclick="location.href='/cs/inquiry';">
      [문의하기]
    </button>
  </div>

  <br>

  <!-- 문의 목록 테이블 -->
  <table border="1" cellpadding="5" cellspacing="0">
    <thead>
    <tr>
      <th>번호</th>
      <th>분류</th>
      <th>제목</th>
      <th>작성일시</th>
      <th>답변여부</th>
    </tr>
    </thead>
    <tbody>
    <!-- 문의 목록 (inquiries 리스트를 Model에 담아야 함) -->
    <tr th:each="inquiry : ${inquiries}">
      <!-- 문의 ID는 고유 번호로 사용 -->
      <td th:text="${inquiry.id}">10</td>
      <!-- 문의 분류명 표시 -->
      <td th:text="${inquiry.category.description}">불만 접수</td>
      <!-- 제목 클릭 시 상세 페이지로 이동 -->
      <td><a th:href="@{|/cs/inquiry/${inquiry.id}|}" th:text="${inquiry.title}">문의 제목입니다.</a></td>
      <!-- 작성일시 포맷팅 -->
      <td th:text="${#temporals.format(inquiry.createdAt, 'yyyy-MM-dd HH:mm')}">2024-10-23 10:00</td>
      <!-- 답변 여부 표시 -->
      <td>
        <span th:if="${inquiry.answered}" style="color: blue;">답변 완료</span>
        <span th:unless="${inquiry.answered}" style="color: red;">답변 안됨</span>
      </td>
    </tr>

    <!-- 문의 목록이 비어 있을 때 -->
    <tr th:if="${#lists.isEmpty(inquiries)}">
      <td colspan="5" style="text-align: center;">
        등록된 문의 내역이 없습니다. 새로운 문의를 작성해주세요.
      </td>
    </tr>
    </tbody>
  </table>

  <hr>

  <p>총 문의 건수: <span th:text="${#lists.size(inquiries)}">0</span> 건</p>

</div>

</body>
</html>
